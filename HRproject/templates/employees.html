<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Employees</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/employees.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
</head>
<body>
  <div class="layout">

    <!-- SIDEBAR -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <nav>
                <a href="{{ url_for('default') }}" style="font-size: 28px; font-weight: bold; text-decoration: none;">
                    <span style="color: turquoise;">HR</span><span style="color: black;">dashboard</span>
                </a>
            </nav>
        </div>

        <div class="user-info">
            <div class="avatar">&#128100;</div>
            <h3>{{ current_user.username }}</h3>
        </div>

        <nav>
            <ul>
                <li><a href="{{ url_for('employees') }}" class="{% if request.endpoint == 'employees' %}active{% endif %}">Employees</a></li>
                <li><a href="{{ url_for('dashboard') }}" class="{% if request.endpoint == 'dashboard' %}active{% endif %}">Dashboard</a></li>
                <li><a href="{{ url_for('archive') }}" class="{% if request.endpoint == 'archive' %}active{% endif %}">Archive</a></li>
            </ul>
        </nav>

        <div class="sidebar-footer">
            <form action="{{ url_for('logout') }}" method="get">
                <button type="submit" class="logout-button"><i class="fas fa-sign-out-alt"></i> Logout</button>
            </form>
        </div>
    </aside>

    <!-- MAIN -->
    <main class="main-content">

      <header>
        <h1>Employees</h1>
        <p>Manage your Employee</p>
      </header>

      <br>

      <!-- ACTIONS -->
      <div class="actions">

        <div class="left-controls">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search employees..." />
                <button class="icon-btn"><i class="fas fa-search"></i></button>
            </div>

            <form method="GET" action="{{ url_for('employees') }}">
                <select name="department" class="filter-dropdown" onchange="this.form.submit()">
                    <option value="" {% if not department_filter %}selected{% endif %}>All Departments</option>
                    <option value="administrative" {% if department_filter == 'administrative' %}selected{% endif %}>Administrative</option>
                    <option value="professors" {% if department_filter == 'professors' %}selected{% endif %}>Professors</option>
                </select>
            </form>

            <button id="rankButton" class="add-new" style="background-color:#555;">Rank</button>
        </div>

        <form action="{{ url_for('new_profile') }}">
            <button class="add-new" type="submit">+ Add New</button>
        </form>

      </div>

      <!-- TABLE -->
      <div class="table-container">
        <table id="employeeTable">
          <thead>
            <tr>
              <th>Employee</th>
              <th>Department</th>
              <th>Added Date</th>
              <th>Interview Status</th>
              <th>AI Score</th>
            </tr>
          </thead>
          <tbody>
            {% if employees %}
              {% for emp in employees %}
                <tr data-id="{{ emp.id }}" onclick="window.location.href='/personal_info/{{ emp.id }}'">
                  <td>
                    {% if emp.status == 'active' %}
                        <span class="status-dot active"></span>
                    {% elif emp.status == 'deleted' %}
                        <span class="status-dot deleted"></span>
                    {% endif %}
                    <strong>{{ emp.first_name }} {{ emp.last_name }}</strong>
                  </td>

                  <td>{{ emp.department.capitalize() }}</td>
                  <td>{{ emp.created_at.strftime('%Y-%m-%d') }}</td>

                  <td>
                        {% if emp.interview_status == 'not_started' %}
                          <span class="status-dot not-started"></span> Not started
                        {% elif emp.interview_status == 'in_progress' %}
                          <span class="status-dot in-progress"></span> In progress
                        {% elif emp.interview_status == 'passed' %}
                          <span class="status-dot passed"></span> Passed
                        {% elif emp.interview_status == 'failed' %}
                          <span class="status-dot failed"></span> Failed
                        {% endif %}
                  </td>

                  <td class="score-cell">
    {% if emp.ai_score is not none %}
        {{ emp.ai_score }}
    {% else %}
        -
    {% endif %}
</td>
                </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="5" style="text-align:center; color: #888;">No employees found.</td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>

    </main>
  </div>

  <script src="{{ url_for('static', filename='js/employees.js') }}?v=2"></script>

</body>
</html>
